<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stick Fight</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
      overflow: hidden;
      touch-action: none;
      user-select: none;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      display: block;
      background: #f0f0f0;
      image-rendering: pixelated;
    }
    #controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      gap: 15px;
      z-index: 10;
    }
    .btn {
      width: 70px;
      height: 70px;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
      touch-action: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    #joystick-container {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 120px;
      height: 120px;
      z-index: 10;
    }
    #joystick-base {
      width: 120px;
      height: 120px;
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      position: relative;
    }
    #joystick-knob {
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      position: absolute;
      top: 35px;
      left: 35px;
      transition: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    #health-container {
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 10;
    }
    .health-bar {
      width: 40%;
      height: 20px;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    .health {
      height: 100%;
      width: 100%;
      background: #4CAF50;
      transition: width 0.3s;
    }
    .health.red { background: #F44336; }
    #p1-label, #p2-label {
      text-align: center;
      color: white;
      font-weight: bold;
      margin-bottom: 5px;
      text-shadow: 1px 1px 2px black;
    }
    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px 40px;
      border-radius: 15px;
      font-size: 24px;
      text-align: center;
      display: none;
      z-index: 20;
    }
    #restart-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <!-- Health Bars -->
    <div id="health-container">
      <div>
        <div id="p1-label">Player 1</div>
        <div class="health-bar"><div id="p1-health" class="health"></div></div>
      </div>
      <div>
        <div id="p2-label">Player 2</div>
        <div class="health-bar"><div id="p2-health" class="health red"></div></div>
      </div>
    </div>

    <!-- Controls -->
    <div id="controls">
      <div class="btn" id="punch-btn">PUNCH</div>
      <div class="btn" id="kick-btn">KICK</div>
    </div>

    <!-- Joystick -->
    <div id="joystick-container">
      <div id="joystick-base">
        <div id="joystick-knob"></div>
      </div>
    </div>

    <!-- Game Over -->
    <div id="game-over">
      <div id="winner-text"></div>
      <button id="restart-btn">Main Lagi</button>
    </div>
  </div>

  <script>
    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Game state
    const game = {
      player1: { x: 150, y: canvas.height - 200, health: 100, facing: 'right', punching: false, kicking: false },
      player2: { x: canvas.width - 200, y: canvas.height - 200, health: 100, facing: 'left' },
      joystick: { active: false, x: 0, y: 0 },
      gameOver: false
    };

    // Resize canvas
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      game.player2.x = canvas.width - 200;
    });

    // Stickman drawing function
    function drawStickman(x, y, facing, punching = false, kicking = false, color = '#333') {
      ctx.strokeStyle = color;
      ctx.lineWidth = 4;
      ctx.lineCap = 'round';

      // Head
      ctx.beginPath();
      ctx.arc(x, y - 80, 20, 0, Math.PI * 2);
      ctx.stroke();

      // Body
      ctx.beginPath();
      ctx.moveTo(x, y - 60);
      ctx.lineTo(x, y - 10);
      ctx.stroke();

      // Arms
      const armAngle = punching ? (facing === 'right' ? -1.2 : 1.2) : 0.3;
      const armX = facing === 'right' ? x + 10 : x - 10;
      ctx.beginPath();
      ctx.moveTo(x, y - 50);
      ctx.lineTo(armX + (facing === 'right' ? 30 : -30) * Math.cos(armAngle), y - 50 + 30 * Math.sin(armAngle));
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x, y - 50);
      ctx.lineTo(armX - (facing === 'right' ? 20 : -20), y - 30);
      ctx.stroke();

      // Legs
      const legOffset = kicking ? 25 : 15;
      ctx.beginPath();
      ctx.moveTo(x, y - 10);
      ctx.lineTo(x - 20, y + legOffset);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(x, y - 10);
      ctx.lineTo(x + 20, y + legOffset);
      ctx.stroke();
    }

    // Update health bars
    function updateHealth() {
      document.getElementById('p1-health').style.width = game.player1.health + '%';
      document.getElementById('p2-health').style.width = game.player2.health + '%';
    }

    // Check collision
    function checkHit(attacker, defender, range = 80) {
      const dist = Math.abs(attacker.x - defender.x);
      return dist < range && attacker.punching || attacker.kicking;
    }

    // Game loop
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ground
      ctx.fillStyle = '#8BC34A';
      ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

      // Update Player 1 movement from joystick
      if (game.joystick.active) {
        const dx = game.joystick.x;
        if (Math.abs(dx) > 20) {
          game.player1.x += dx * 0.3;
          game.player1.facing = dx > 0 ? 'right' : 'left';
        }
        game.player1.x = Math.max(50, Math.min(canvas.width - 50, game.player1.x));
      }

      // AI simple untuk Player 2 (mengikuti Player 1)
      if (!game.gameOver) {
        const diff = game.player1.x - game.player2.x;
        if (Math.abs(diff) > 100) {
          game.player2.x += diff > 0 ? 1.5 : -1.5;
          game.player2.facing = diff > 0 ? 'right' : 'left';
        }

        // AI attack
        if (Math.abs(diff) < 90 && Math.random() < 0.02) {
          game.player2.punching = true;
          setTimeout(() => game.player2.punching = false, 300);
          if (checkHit(game.player2, game.player1)) {
            game.player1.health = Math.max(0, game.player1.health - 10);
            updateHealth();
          }
        }
        if (Math.abs(diff) < 100 && Math.random() < 0.015) {
          game.player2.kicking = true;
          setTimeout(() => game.player2.kicking = false, 400);
          if (checkHit(game.player2, game.player1, 100)) {
            game.player1.health = Math.max(0, game.player1.health - 15);
            updateHealth();
          }
        }
      }

      // Draw players
      drawStickman(game.player1.x, game.player1.y, game.player1.facing, game.player1.punching, game.player1.kicking, '#2196F3');
      drawStickman(game.player2.x, game.player2.y, game.player2.facing, game.player2.punching, game.player2.kicking, '#F44336');

      // Reset attack animations
      setTimeout(() => {
        game.player1.punching = false;
        game.player1.kicking = false;
      }, 300);

      // Check game over
      if (game.player1.health <= 0 || game.player2.health <= 0) {
        game.gameOver = true;
        document.getElementById('winner-text').textContent = 
          game.player1.health <= 0 ? 'Player 2 Menang!' : 'Player 1 Menang!';
        document.getElementById('game-over').style.display = 'block';
      }

      requestAnimationFrame(gameLoop);
    }

    // Controls
    document.getElementById('punch-btn').addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!game.gameOver) {
        game.player1.punching = true;
        if (checkHit(game.player1, game.player2)) {
          game.player2.health = Math.max(0, game.player2.health - 12);
          updateHealth();
        }
      }
    });

    document.getElementById('kick-btn').addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!game.gameOver) {
        game.player1.kicking = true;
        if (checkHit(game.player1, game.player2, 100)) {
          game.player2.health = Math.max(0, game.player2.health - 18);
          updateHealth();
        }
      }
    });

    // Joystick
    const joystickBase = document.getElementById('joystick-base');
    const knob = document.getElementById('joystick-knob');
    let joystickCenter = {};

    function getOffset(el) {
      const rect = el.getBoundingClientRect();
      return { x: rect.left + 60, y: rect.top + 60 };
    }

    joystickBase.addEventListener('touchstart', (e) => {
      e.preventDefault();
      game.joystick.active = true;
      joystickCenter = getOffset(joystickBase);
    });

    document.addEventListener('touchmove', (e) => {
      if (game.joystick.active) {
        const touch = e.touches[0];
        const dx = touch.clientX - joystickCenter.x;
        const dy = touch.clientY - joystickCenter.y;
        const dist = Math.min(35, Math.sqrt(dx*dx + dy*dy));
        const angle = Math.atan2(dy, dx);
        game.joystick.x = dist * Math.cos(angle);
        game.joystick.y = dist * Math.sin(angle);

        knob.style.left = (55 + game.joystick.x) + 'px';
        knob.style.top = (55 + game.joystick.y) + 'px';
      }
    });

    document.addEventListener('touchend', () => {
      if (game.joystick.active) {
        game.joystick.active = false;
        game.joystick.x = 0;
        game.joystick.y = 0;
        knob.style.left = '35px';
        knob.style.top = '35px';
      }
    });

    // Restart
    document.getElementById('restart-btn').addEventListener('click', () => {
      game.player1.health = 100;
      game.player2.health = 100;
      game.player1.x = 150;
      game.player2.x = canvas.width - 200;
      game.gameOver = false;
      updateHealth();
      document.getElementById('game-over').style.display = 'none';
    });

    // Start game
    updateHealth();
    gameLoop();
  </script>
</body>
</html>